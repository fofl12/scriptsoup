<!DOCTYPE html>
<html>
  <head>
    <title>scriptsoup</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <meta name="description" content="List of epic things" />
    <meta name="keywords" content="Lua, Roblox" />
    <meta name="author" content="snoo8" />
    <link href="./style.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container">
      <h1>Scripts</h1>
	  <input id="darkModeCheckbox" type="checkbox" onclick="updateDarkMode()">Dark Mode</input> <br/>
      <button type="button" onclick="updateList()">Update</button>
      <dl id="list"></dl>
      <script>
        var list = document.getElementById("list");
		var darkModeCheckbox = document.getElementById("darkModeCheckbox");
		var darkMode = localStorage.getItem('dark-theme');
		var root = document.querySelector(':root');
		darkModeCheckbox.checked = darkMode;
		updateDarkModeCSS(darkMode);
        function getRequest(url, callback) {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = callback;
          xhttp.open("GET", url);
          xhttp.send();
        }
        function updateList() {
          getRequest(
            "https://api.github.com/repos/snoo8/scriptsoup/contents/out",
            function () {
              if (this.readyState == 4 && this.status == 200) {
                list.innerHTML = "";
                var converted = JSON.parse(this.responseText);
                converted.forEach((element) => {
				  if (element.name.split('.')[1] !== 'lua') {
					  return;
				  }
                  var title = document.createElement("dt");
                  title.innerHTML = `<a href="${element.html_url}">${element.name}</a>`;
                  var description = document.createElement("dd");
                  getRequest(element.download_url, function () {
                    if (this.readyState == 4 && this.status == 200) {
                      description.innerHTML = this.responseText.substr(35, 60);
                    }
                  });
                  list.appendChild(title);
                  list.appendChild(description);
                });
              }
            }
          );
        }
		function updateDarkModeCSS(checked) {
			if (checked) {
				root.classList.add('dark-theme');
			} else {
				root.classList.remove('dark-theme');
			}
		}
		function updateDarkMode() {
			darkMode = !darkMode;
			updateDarkModeCSS(darkMode);
			localStorage.setItem('dark-theme', darkMode);
		}
        updateList();
      </script>
    </div>
  </body>
</html>